{# templates/profile_page/public_profile.html #}
{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-4">

  <!-- Header -->
  <div class="d-flex align-items-center justify-content-between gap-3 mb-4">
    <div class="d-flex align-items-center gap-3">
      <div>
        {% if profile and profile.profile_image %}
          <img
            src="{{ profile.profile_image.url }}"
            class="rounded-circle shadow-sm"
            alt="{{ view_user.username }} avatar"
            style="width: 72px; height: 72px; object-fit: cover"
          >
        {% else %}
          <div class="rounded-circle bg-light d-flex align-items-center justify-content-center shadow-sm"
               style="width: 72px; height: 72px">
            <span class="text-muted fs-4">@</span>
          </div>
        {% endif %}
      </div>
      <div>
        <h3 class="mb-0">@{{ view_user.username }}</h3>

        {% if profile and profile.bio %}
          <div class="text-muted small mt-1">{{ profile.bio }}</div>
        {% endif %}

        <div class="small text-muted mt-1">
          <strong id="followersCount">{{ followers_count }}</strong> followers Â· {{ following_count }} following
        </div>

        {% if profile and profile.website %}
          <div class="small mt-1">
            <a href="{{ profile.website }}" rel="nofollow noopener" target="_blank">{{ profile.website }}</a>
          </div>
        {% endif %}
      </div>
    </div>

    {% if request.user.is_authenticated and request.user.id != view_user.id %}
      <button
        class="btn btn-sm {{ is_following|yesno:'btn-outline-danger,btn-outline-primary' }}"
        data-follow-toggle="{% url 'follow:toggle' view_user.username %}"
        data-followers-target="#followersCount">
        {{ is_following|yesno:"Unfollow,Follow" }}
      </button>
    {% endif %}
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="profileTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="albums-tab" data-bs-toggle="tab" data-bs-target="#albums" type="button" role="tab">
        Public Albums
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tracks-tab" data-bs-toggle="tab" data-bs-target="#tracks" type="button" role="tab">
        Public Tracks
      </button>
    </li>
  </ul>

  <div class="tab-content pt-3">

    <!-- Public Albums -->
    <div class="tab-pane fade show active" id="albums" role="tabpanel" aria-labelledby="albums-tab">
      <ul class="list-group">
        {% for a in public_albums %}
          {# Reuse the album card. We explicitly disable reordering/search on a public profile. #}
          {% include "album/_album_card.html" with album=a allow_reorder=False show_search=False %}
        {% empty %}
          <li class="list-group-item">No public albums yet.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Public Tracks -->
    <div class="tab-pane fade" id="tracks" role="tabpanel" aria-labelledby="tracks-tab">
      <ul class="list-group">
        {% for t in public_tracks %}
          {# Reuse the track card. No album context here; keep it lightweight. #}
          {% include "tracks/_track_card.html" with track=t show_checkbox=False allow_reorder=False avg=t.rating_avg count=t.rating_count %}
        {% empty %}
          <li class="list-group-item">No public tracks yet.</li>
        {% endfor %}
      </ul>
    </div>

  </div>
</div>

<!-- Follow System JS -->
<script src="{% static 'js/follow_system.js' %}" defer></script>
{% endblock %}
