{# Reusable card for a single track #}
<li class="list-group-item p-2 track-card d-flex flex-column gap-2" data-track-id="{{ track.id }}">
  <div class="d-flex align-items-center gap-2 flex-wrap">
    <!-- Title -->
    <span class="fw-semibold me-1">{{ track.name }}</span>

    <!-- Album link -->
    {% if album %}
      <a class="text-decoration-none small text-muted" href="{% url 'album_detail' album.id %}">Â· {{ album.name }}</a>
    {% endif %}

    <!-- Author link -->
    <a class="text-decoration-none small text-muted" href="{% url 'user_tracks' track.owner.username %}">Â· {{ track.owner.username }}</a>

    <!-- Actions -->
    <span class="ms-auto d-flex align-items-center gap-1">
      <!-- Favourite -->
      <button class="btn btn-sm {% if is_favorited %}btn-danger{% else %}btn-outline-danger{% endif %} js-fav"
              data-url="{% url 'toggle_favorite' track.id %}" title="Favourite">â™¥</button>

      <!-- Save -->
      {% if request.user.is_authenticated and request.user.id != track.owner_id %}
        <button class="btn btn-sm btn-outline-secondary js-save"
                data-save-url="{% url 'save_track' track.id %}"
                title="Save to one of my albums">ðŸ’¾</button>
      {% endif %}

      <!-- Download -->
      <a class="btn btn-sm btn-outline-secondary" href="{% url 'download_track' track.id %}" title="Download">â¬‡</a>

      <!-- Play -->
      <button class="btn btn-sm btn-primary js-inline-play" title="Play/Pause">â–¶</button>

      <!-- Rating -->
      <span class="ms-1 rating-wrap">
        {% include "ratings/_stars.html" with type="track" id=track.id avg=avg|default:track.rating_avg|default:0 count=count|default:track.rating_count|default:0 user_rating=None %}
      </span>
    </span>
  </div>

  <!-- Inline audio -->
  {% if track.audio_file %}
    <audio class="inline-audio d-none" preload="none" src="{{ track.audio_file.url }}" data-log-url="{% url 'log_play' track.id %}"></audio>
  {% elif track.source_url %}
    <audio class="inline-audio d-none" preload="none" src="{{ track.source_url }}" data-log-url="{% url 'log_play' track.id %}"></audio>
  {% endif %}
</li>
