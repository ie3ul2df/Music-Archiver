{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container py-4">
  <h3>{{ album.name }}</h3>

  <!-- ⭐ Album rating -->
  <div class="mb-3">
    {% include "ratings/_stars.html" with type="album" id=album.id avg=album.rating_avg count=album.rating_count user_rating=None %}
  </div>

  <!-- Track add form -->
  <form method="post" enctype="multipart/form-data" class="row g-2 my-3">
    {% csrf_token %}
    <div class="col-md-3">
      <input name="name" class="form-control" placeholder="Track name" required />
    </div>
    <div class="col-md-4">
      <input name="source_url" class="form-control" placeholder="https://audio-link.mp3" />
    </div>
    {% if has_storage %}
      <div class="col-md-3">
        <input type="file" name="audio_file" accept="audio/*" class="form-control" />
      </div>
    {% endif %}
    <div class="col-md-2 d-grid">
      <button class="btn btn-primary">Add Track</button>
    </div>
  </form>

  <p class="text-muted">
    Provide a link OR upload a file
    {% if not has_storage %}(upload requires a storage plan){% endif %}.
  </p>

  <!-- Track list -->
  <ul id="track-list" class="list-group"
      data-album-id="{{ album.id }}"
      data-reorder-url="{% url 'album:album_reorder_tracks' album.pk %}">
    {% for at in items %}
      {% include "tracks/_track_card.html" with track=at.track album=album album_item_id=at.id is_owner=is_owner is_favorited=at.is_favorited avg=at.track_avg count=at.track_count custom_name=at.custom_name %}
    {% empty %}
      <li class="list-group-item text-muted">No tracks yet.</li>
    {% endfor %}
  </ul>

</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/album_utils.js' %}" defer></script>
<script src="{% static 'js/album_detail.js' %}" defer></script>
{% endblock %}

{% block extra_modals %}
  {% include "album/_rename_track_modal.html" %}
  {% include "album/_delete_track_modal.html" %}
{% endblock %}