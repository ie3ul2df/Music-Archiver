{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container py-4">
  <h3>{{ album.name }}</h3>

  <!-- ⭐ Album rating -->
  <div class="mb-3">
    {% include "ratings/_stars.html" with type="album" id=album.id avg=album.rating_avg count=album.rating_count user_rating=None %}
  </div>

  <!-- Track add form -->
  <form method="post" enctype="multipart/form-data" class="row g-2 my-3">
    {% csrf_token %}
    <div class="col-md-3">
      <input name="name" class="form-control" placeholder="Track name" required />
    </div>
    <div class="col-md-4">
      <input name="source_url" class="form-control" placeholder="https://audio-link.mp3" />
    </div>
    {% if has_storage %}
      <div class="col-md-3">
        <input type="file" name="audio_file" accept="audio/*" class="form-control" />
      </div>
    {% endif %}
    <div class="col-md-2 d-grid">
      <button class="btn btn-primary">Add Track</button>
    </div>
  </form>

  <p class="text-muted">
    Provide a link OR upload a file
    {% if not has_storage %}(upload requires a storage plan){% endif %}.
  </p>


  <!-- Track list -->
  <ul class="list-group">
    {% for at in items %}
      {% include "tracks/_track_card.html" with track=at.track album=album is_favorited=at.is_favorited avg=at.track_avg count=at.track_count %}
    {% empty %}
      <li class="list-group-item text-muted">No tracks yet.</li>
    {% endfor %}
  </ul>

  <!-- Rename modal -->
  <div class="modal fade" id="renameTrackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="post" id="renameTrackForm">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title">Rename Track</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="text" name="name" id="renameTrackInput" class="form-control" required />
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete modal -->
  <div class="modal fade" id="deleteTrackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="post" id="deleteTrackForm">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title">Delete Track</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete <strong id="deleteTrackName"></strong>?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-danger">Delete</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/album_detail.js' %}" defer></script>
{% endblock %}
