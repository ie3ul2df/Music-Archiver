{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container py-4">

  {# --- Add Track form (owner only; unchanged) --- #}
  <form method="post" enctype="multipart/form-data" class="row g-2 my-3">
    {% csrf_token %}
    <div class="col-md-3">
      <input name="name" class="form-control" placeholder="Track name" required />
    </div>
    <div class="col-md-4">
      <input name="source_url" class="form-control" placeholder="https://audio-link.mp3" />
    </div>
    {% if has_storage %}
      <div class="col-md-3">
        <input type="file" name="audio_file" accept="audio/*" class="form-control" />
      </div>
    {% endif %}
    <div class="col-md-2 d-grid">
      <button class="btn btn-primary">Add Track</button>
    </div>
  </form>

  <p class="text-muted">
    Provide a link OR upload a file
    {% if not has_storage %}(upload requires a storage plan){% endif %}.
  </p>

  {# --- Reuse the full album card (header, stars, bulk toolbar, tracks) --- #}
  {% include "album/_album_card.html" with album=album owner_url=owner_url rename_url=rename_url toggle_visibility_url=toggle_visibility_url delete_url=delete_url show_search=True allow_reorder=True %}

</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/album_utils.js' %}" defer></script>
  <script src="{% static 'js/album_detail.js' %}" defer></script>
  <script src="{% static 'js/album_tracks_loader.js' %}" defer></script>
{% endblock %}

{% block extra_modals %}
  {# Track modals #}
  {% include "album/_rename_track_modal.html" %}
  {% include "album/_delete_track_modal.html" %}

  {# Album modals (needed for ‚úè Edit / üóë Delete on the card) #}
  {% include "album/_rename_album_modal.html" %}
  {% include "album/_delete_album_modal.html" %}
{% endblock %}
