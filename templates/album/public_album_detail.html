{# templates/album/public_album_detail.html #}
{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-4">
  <!-- Album header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="mb-0">{{ album.name }}</h2>
      <small class="text-muted">
        by {{ album.owner.username }}
        {% if album.is_public %}
          Â· <span class="badge bg-success">Public</span>
        {% else %}
          Â· <span class="badge bg-secondary">Private</span>
        {% endif %}
      </small>
    </div>

    {% if request.user.is_authenticated and album.owner_id != request.user.id and album.is_public %}
      <a href="{% url 'save_system:save_album' album.pk %}"
         data-save-album="1"
         class="btn btn-sm btn-outline-success">ðŸ’¾ Save Album</a>
    {% endif %}
  </div>

  {% if album.description %}
    <p class="text-muted">{{ album.description }}</p>
  {% endif %}

  <!-- Track list -->
  <ul class="list-group">
    {% for at in items %}
      {% include "tracks/_track_card.html" with track=at.track album=album is_favorited=at.is_favorited avg=at.track_avg count=at.track_count %}
    {% empty %}
      <li class="list-group-item text-muted">No tracks yet.</li>
    {% endfor %}
  </ul>
</div>

{% if request.user.is_authenticated %}
  <!-- Save Track Modal -->
  <div class="modal fade" id="saveTrackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="saveTrackForm" method="post">
          {% csrf_token %}
          <input type="hidden" name="album_id" id="albumSelectHidden" />
          <div class="modal-header">
            <h5 class="modal-title">Save Track to Your Album</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            {% if user_albums %}
              <label for="albumSelect" class="form-label">Choose Album</label>
              <select name="album_id" id="albumSelect" class="form-select">
                {% for a in user_albums %}
                  <option value="{{ a.id }}">{{ a.name }}</option>
                {% endfor %}
              </select>
            {% else %}
              <p class="text-muted mb-0">You donâ€™t have any albums yet. Create one first.</p>
            {% endif %}
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" {% if not user_albums %}disabled{% endif %}>Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Save-System JS -->
  <script src="{% static 'js/save_system.js' %}" defer></script>
{% endif %}
{% endblock %}
